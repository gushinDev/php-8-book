# Протокол HTTP

Работа любого сайта строится по клиент-серверной технологии: браузер - клиент, сервер - ПО на компьютере в сети, прослушивающее определенный порт. Прослушав запрос, сервер отправляет ответ, используя TCP/IP
Сервером может выступать, как ПО, запущенное на компьютере, так и мощный компьютер, где запущено ПО.
- Правила и порядок обмена запросами и ответами, определяются в протоколе HTTP
- Протокол предназначен для запроса у сервера и передачи браузеру HTML документов и сопутствующих файлов
- Каждый раз, при переходе по страницам, мы шлем HTTP запрос серверу, в ответ сервер присылает HTTP ответ, чаще всего HTML страницу
- При загрузке HTML страницы формируются также запросы на файлы стилей , js, фотографии ит.д. Для каждого файла формируется отдельный запрос.
- Для отличия данных друг от друга используется ресурс (уникальный идентификатор источника) - унифицированный указатель ресурса URL (Uniform  Resource Locator)
- В качестве ресурса может выступать не только статические файлы. В этом случае ресурсу соответствует ПО, генерирующее ответ на лету

## Параметры URL
- Для передачи вводных данных на сервер используются параметры. 
- Способ посылки параметров, когда данные помещаются в строку, называется GET методом.

## Методы
- GET - запрос на получение ресурса, ответ может кэшироваться
- POST - запрос на создание ресурса, ответ никогда не кэшируется 
- PUT - Сохранение/Обновление ресурса - ответ не кэшируется
- DELETE - Удаление ресурса
- HEAD - Получение в ответ на запрос только HTTP заголовков

## HTTP сообщения
Клиент и сервер общаются друг с другом HTTP-сообщениями, которые состоят из трех часте: начальная строка, HTTP-заголовки, тело сообщения(необязательная часть)
- Начальная строка и заголовки - обычный текст, который можно читать без декодирования
- В теле могут быть бинарные или текстовые данные (изображение, HTML страница)
- Начальная строка содержит метод, ресурс на сервере, версию протокола <метод> <ресурс> <версия протокола> GET / HTTP/1.1
- Начальная строка ответа состоит из <версия протокола> <HTTP-код> <текстовая расшифровка HTTP-кода> HTTP/1.1 200 OK
- HTTP заголовки содержат различную мета-информацию, а в теле документа передается HTML или файл
- В основном тело запроса присутствует в запросах POST/PUT, в ответах тело есть всегда, кроме HEAD-ответа

## Заголовки
Заголовки строятся как пары ключ:значение, в конце используется \r\n
Заголовки прилетают как от клиента, так и от сервера
- Host: example.com - каждый клиент отправляет заголовок хост, который содержит доменное имя(env = HTTP_HOST)
- Accept: text/html - сообщает, что клиент хочет получить заголовки ввиде HTML-страницы
- User-Agenr (HTTP_USER_AGENT) - клиент сообщает сведения о себе
- Refferer - (HTTP_REFFERER) - формируется браузером и содержит урл страницы, с которой осуществляется переход на текущую
- \r\n\r\n - сообщает об окончании заголовка запроса
GET example.com HTTP/1.0 \r\n
Accept: text/html\r\n
\r\n\r\n
- Не все заголовки обрабатываются веб-сервером, некоторые передаются в качестве енв переменных пхп-скрипту
- Переменные окружения - именованные список параметров, который ОС передает запущеной программе. Программа может получить с помощью специальных функций значение этих переменных
- Content-Type: text/html - сообщает о формате присланного документа (переменная окружения CONTENT_TYPE)
- Content-Length: 256715 - размер загружаемого документа в байтах, по которому браузер оценивает процент загрузки документа (CONTENT_LENGTH)
- Server: nginx - сообщает название веб-сервера
- Cookie - HTTP_COOKIE - хранит куки
- Accept - HTTP_ACCEPT браузер перечисляет, какие типы он понимает, через запятую

## HTTP-коды ответов
Каждый ответ сервера сопровождается статус кодом. Они всегда трехзначные, начинаются с 1-5
- 1 - информационные
- 2 - успешное выполнение запроса
- 3 - Переадресация
- 4 - Ошибочный запрос со стороны клиента
- 5 - Ошибка на стороне сервера
301 - переадресация постоянная, 302 временная

## Утилита curl
Утилита позволяет сделать запрос на определенные ресурсы прямо из консоли.
- i - получить заголовки
- H - указать свой заголовок
Чтобы выполнить пост запрос, нужно указать -X POST - указывает метод и -d '{"login": "admin", ...}' -указывает тело
curl -X POST -d '{"username":"admin"}' google.com - передает json структуру, но можно передавать пары ключ:значение ввиде 'login=admin&password...'
- F передает на сервер файл, с ним передается название поля, в котором сервер ожидает файл
curl -X POST -F "file=@/path/to/file/image.jpg" "google.com"
- V подробное логирование действий
